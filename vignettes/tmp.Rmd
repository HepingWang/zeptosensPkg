---
title: "Zeptosens"
output: 
  html_document:
    toc: true
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
require("knitr")
opts_chunk$set(fig.align="center", fig.width=6, fig.height=6, dpi=300)
```

## Purpose
* Zeptosens analysis

## Setup 
```{r loadLibraries, message=FALSE, warning=FALSE}
library(xlsx)
library(zeptosensPkg)
```

##
```{r}
tpl_n <- read.table("inst/dataInst/tpl_norm.txt", header=TRUE, sep="\t", comment.char='')

a2058 <- readZeptosensExport("inst/dataInst/R022_A2058_RFI_Export_Table.xls", c("sampleName", "treatment", "time"))
skmel133 <- readZeptosensExport("inst/dataInst/R023_Mel133_RFI_Export_Table.xls", c("sampleName", "treatment", "time"))

orgCtrlIdx <- 64
nAb <- unique(a2058[, "antibody"])

ratios <- NULL
    
for(i in 1:length(nAb)) {
    ctrlIdx <- orgCtrlIdx*i
    
    t1 <- sum(a2058[c(ctrlIdx, ctrlIdx+1), "readout"])
    t2 <- sum(skmel133[c(ctrlIdx, ctrlIdx+1), "readout"])
    
    ratios <- c(ratios, t1/t2)
}

ratios <- data.frame(antibodyNames=nAb, ratios=ratios)

write.table(ratios, file="inst/dataInst/a2058_skmel133_ctrlRatios.txt", sep="\t", col.names=TRUE, row.names=FALSE, quote=FALSE)

normCoef <- ratios[, "ratios"] %*% t(tpl_n[, "tpl_norm_const"])

for(i in 1:ncol(normCoef)) {
    for(j in 1:nrow(normCoef)) {
        a2058[, "readout"]
    }
}
```
