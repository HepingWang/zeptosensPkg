---
title: "4 Cell Lines"
output: 
  html_document:
    toc: true
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
require("knitr")
opts_knit$set(root.dir="..")
opts_chunk$set(fig.align="center", fig.width=6, fig.height=6, dpi=300)

```

## Purpose
* Zeptosens analysis

## Setup 
```{r loadLibraries, message=FALSE, warning=FALSE}
library(xlsx)
library(zeptosensPkg)
```

## Normalization
```{r}
inputFile <- "inst/dataInst/R006_RFI_Export_Table.xls"
data <- readZeptosensXls(inputFile)

tmp <- data[which(grepl("melanoma", data[, "Sample.Name"], ignore.case=TRUE)),]

# Example Sample Name: S001_cell line_Melanoma_A2058 _DMSO_1hr_rep1

array1 <- readZeptosensExport(tmp, c("sampleNameNumber", "NA", "NA", "sampleName", "treatment", "time", "replicate"))

colClasses <- c("character","character","numeric")


        
tpl_1 <- read.xlsx2("inst/dataInst/R022_A2058_sample_conc_EZQ.xlsx", colClasses=colClasses, stringsAsFactors=F, sheetIndex=1)
tpl_2 <- read.xlsx2("inst/dataInst/R023_Mel133_sample_conc_EZQ.xlsx", colClasses=colClasses, stringsAsFactors=F, sheetIndex=1)
print(tpl_1)

array1 <- readZeptosensExport("inst/dataInst/R022_A2058_RFI_Export_Table.xls", c("sampleName", "treatment", "time"))
array2 <- readZeptosensExport("inst/dataInst/R023_Mel133_RFI_Export_Table.xls", c("sampleName", "treatment", "time"))

controlProbeIndex <- 65
antibodyNum <- unique(array1[, "antibody"])

results <- normalizeZeptosensData(tpl_1, tpl_2, controlProbeIndex, antibodyNum)

write.table(results$normArray1, file="inst/dataInst/normA2058.txt", sep="\t", quote=FALSE, row.names=FALSE, col.names=TRUE)
write.table(results$normArray2, file="inst/dataInst/normSkmel133.txt", sep="\t", quote=FALSE, row.names=FALSE, col.names=TRUE)
```

## Plotting 
```{r}
normA2058 <- results$normArray1
normSkmel133 <- results$normArray2
    
antibodies <- unique(normA2058[, "antibody"])
excludeTreatments <- c("DMSO", "DMSO-2")
ctrlTreatment <- "DMSO"
ctrlTime <- "5min"
plotColNames <- c("A2058", "SkMel133")
plotRowNames <- c("0m", "5m", "15m", "30m", "1h", "12h", "24h", "48h")
plotColors <- c("darkblue","red")
plotDir <- "inst/tmp/"

plotZeptosensData(normA2058, normSkmel133, antibodies, excludeTreatments, ctrlTreatment, ctrlTime, plotColNames, plotRowNames, plotColors, plotDir)
```
